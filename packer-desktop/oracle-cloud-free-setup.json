{
  "provisioners": [
    {
      "type": "file",
      "only": ["guacamole-gateway"],
      "source": "packer-desktop/vartmp-uploads/gateway/",
      "destination": "/var/tmp/"
    },

    {
      "type": "file",
      "only": ["guacamole-gateway"],
      "source": "packer-desktop/gateway-home-uploads/",
      "destination": "/home/ubuntu/uploads/"
    },

    {
      "only": ["guacamole-gateway"],
      "execute_command": "echo 'ubuntu' | {{.Vars}} sudo -S -E sh -eux '{{.Path}}'",
      "scripts": [
        "{{user `script_dir`}}/gateway/motd.sh"
      ],
      "type": "shell"
    },
    {
      "environment_vars": [
        "FULLY_QUALIFIED_DOMAIN={{user `full_domain`}}"
      ],
      "execute_command": "echo 'ubuntu' | {{.Vars}} sudo -S -E sh -eux '{{.Path}}'",
      "scripts": [
        "{{user `script_dir`}}/common/before_final_reboot.sh"
      ],
      "type": "shell"
    },
    {
      "type": "shell",
      "execute_command": "echo 'ubuntu' | {{.Vars}} sudo -S -E sh -eux '{{.Path}}'",
      "inline": ["reboot"],
      "expect_disconnect": true
    },
    {
      "type": "shell",
      "execute_command": "echo 'ubuntu' | {{.Vars}} sudo -S -E sh -eux '{{.Path}}'",
      "script": "{{user `script_dir`}}/common/after_final_reboot.sh",
      "pause_before": "10s"
    }
  ]
}

Content-Type: multipart/mixed; boundary="====Part=Boundary================================================="
MIME-Version: 1.0

--====Part=Boundary=================================================
Content-Type: text/cloud-config; charset="us-ascii"
Content-Transfer-Encoding: 7bit
Content-Disposition: attachment; filename="cloud-config.yaml"

# Set the locale
locale: de_DE

# Set the system timezone
timezone: Europe/Berlin

packages:
     - libreoffice-calc
     - libreoffice-writer
     - libreoffice-impress

# Add each entry to ~/.ssh/authorized_keys for the configured user or the
# first user defined in the user definition directive.
ssh_authorized_keys:
    - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDKr00/X5wg6BTv1eJgpk9AyDTxVC4OzGuJrPSaHek8fiCQa2H79ZIpoe/hnMTIkGXBukSnpH3Vz1hNV6V5b588iAP9EIHTa4NjbBbmHofdHXKxv2bJZWPmVoo6rmejNiE4yFJpi/aWzVpgjJu6WBU0FAcf3/ZUT5a9zVXzl/V9Yw5WJrGMPFfD/v9xreE4KejNUcfRjfHifzmTedd3arD9eooQtyd6F18hF5fqtm/BafYWcc6ico9BWHzx3P39dyJxaHeQ9+NCEBm/mJeID8MPTUOwTQT0Ku1Z/FHi6W17ib2jjpYo/fSDj5i40BayjviH2AH1GumBywU/WNPVtocluCbwbRuyAODHhARCEXl1xO7FNG2TxaG9ELM8056jcMKjruuhllYhlVD4HcLgdWJtnVpLesv694X2Z7n/BFizYluu9q07/Ruh2jfiXuQGCo71jDbEP1EJbingy4lXr6hY6/582PcKbmivr+iLE6HADEUj7ehLs/fyNALyGch4Jds= jens@Jenss-MBP.fritz.box

no_ssh_fingerprints: true

--====Part=Boundary=================================================
Content-Type: text/x-shellscript; charset="us-ascii"
Content-Transfer-Encoding: 7bit
Content-Disposition: attachment; filename="100-pull-latest-release.sh"

#!/usr/bin/env bash

cd /var/tmp/traction
sudo git fetch
sudo git reset --hard origin/master
sudo chmod +x run_app.sh

cat << EOF | sudo tee /home/vagrant/Desktop/ideops.desktop
[Desktop Entry]
Type=Application
Terminal=true
Exec=/var/tmp/traction/run_app.sh
Icon=QMPlay2
Name=Hier klicken
EOF
sudo chmod +x /home/vagrant/Desktop/ideops.desktop

docker pull --quiet jafudi/idea-extractor:latest &

--====Part=Boundary=================================================
Content-Type: text/x-shellscript; charset="us-ascii"
Content-Transfer-Encoding: 7bit
Content-Disposition: attachment; filename="200-register-gitlab-runner.sh"

#!/usr/bin/env bash

sudo gitlab-runner unregister --all-runners
sudo rm -f /etc/gitlab-runner/config.toml

DESCRIPTION="Shell executor on $(uname -s)"

HOST_TAGS="$( \
    hostnamectl \
    | sed -E -e 's/^[ ]*//;s/[^a-zA-Z0-9\.]+/-/g;s/(.*)/\L\1/;' \
    | tr '\n' ',' \
)"

ROUTE_TAGS="$( \
    traceroute --max-hops=3 8.8.8.8 \
    | sed -E -e '1d;s/^[ ]+[0-9][ ]+([a-zA-Z]+?).*/\1/;/^$/d;s/^/gateway-/' \
    | tr '\n' ',' \
)"

sudo gitlab-runner register \
--non-interactive \
--url="https://gitlab.com/" \
--registration-token="JW6YYWLG4mTsr_-mSaz8" \
--executor="shell" \
--description="${DESCRIPTION}" \
--tag-list="${HOST_TAGS},${ROUTE_TAGS}"

sudo gitlab-runner restart
sudo gitlab-runner status

--====Part=Boundary=================================================
Content-Type: text/x-shellscript; charset="us-ascii"
Content-Transfer-Encoding: 7bit
Content-Disposition: attachment; filename="300-serve-guacamole.sh"

#!/usr/bin/env bash

export GUACAMOLE_HOME=/var/tmp/traction/guacamole
export ETH0_IP=$(ip addr show eth0 | grep "inet\b" | awk '{print $2}' | cut -d/ -f1)
cd ${GUACAMOLE_HOME}
./prepare.sh
./init-letsencrypt.sh
#Â docker-compose up --detach --quiet-pull &

--====Part=Boundary=================================================--